<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 - PL SQL Cursor - Albasel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
</head>
<body>
    <nav class="topnav">
    <div class="topnav-inner">
        <a href="/" class="topnav-logo">Albasel</a>
        
        <button class="nav-hamburger" id="nav-hamburger" aria-label="Toggle menu">
            <i class="fas fa-bars"></i>
        </button>

        <ul class="topnav-links" id="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/posts.html">Posts</a></li>
            <li><a href="/categories.html">Categories</a></li>
            <li><a href="/aboutme.html">About</a></li>
        </ul>

        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
            <i class="fa-solid fa-moon" id="theme-icon"></i>
        </button>
    </div>
</nav>


    <div class="main-content">
        <article class="article">
            <header class="article-header">
                <h1>7 - PL SQL Cursor</h1>
                <div class="article-meta">
                    
                    <time>2025-09-02</time>
                </div>
                
                <img src="https://picsum.photos/seed/oracle-7 - PL SQL Cursor/800/400" alt="7 - PL SQL Cursor" class="article-image" onerror="this.style.display='none'">
                
            </header>

            <div class="post-content">
                <h1>7   Cursor</h1>
<p>A cursor in PL/SQL is a pointer (or handle) to the result set of a SQL query.</p>
<ul>
<li>It allows PL/SQL to access rows returned by SQL one by one.</li>
<li>Without cursors, PL/SQL wouldn’t know how to deal with multi-row results.</li>
</ul>
<h2>Implicit Cursors:</h2>
<p>Created automatically by Oracle when you run a SQL statement.
Used for:</p>
<ul>
<li>INSERT, UPDATE, DELETE, MERGE</li>
<li>SELECT … INTO … (must return exactly one row).</li>
</ul>
<p>Attributes you can check:</p>
<ul>
<li><strong>SQL%ROWCOUNT</strong> → number of rows affected.</li>
<li><strong>SQL%FOUND</strong> → TRUE if rows were affected.</li>
<li><strong>SQL%NOTFOUND</strong> → TRUE if no rows were affected.</li>
<li><strong>SQL%ISOPEN</strong> → always&gt;</li>
</ul>
<h2>Explicit Cursor</h2>
<ul>
<li>Declare</li>
<li>Open</li>
<li>Fetch</li>
<li>Close</li>
</ul>
<h3>Explicit Cursor Attributes</h3>
<ul>
<li><strong>%ISOPEN</strong>
<ul>
<li>Checks if the cursor is read</li>
</ul>
</li>
<li><strong>%FOUND</strong>
<ul>
<li>Checks if data is found</li>
</ul>
</li>
<li><strong>%NOTFOUND</strong>
<ul>
<li>Checks if data is not f</li>
</ul>
</li>
<li><strong>%ROWCOUNT</strong>
<ul>
<li>returns number of data returned</li>
</ul>
</li>
</ul>
<h2>FOR UPDATE</h2>
<p>This keyword locks the records a cursor is selecting until you finish working on the query.</p>
<pre class="hljs"><code>DECLARE 
cursor c_emp is
       SELECT * FROM Employee WHERE Department_id = 30 FOR UPDATE
BEGIN
     for v_emp in c_emp
     LOOP
     dbms_output.putline(...)
     END LOOP
END                       
</code></pre>
<p>Now if someone is trying to update this row the cursor is pointing at he can’t as its locked for waiting until you rollback or you can define it so it gives him an error or wait for some time.</p>
<h2>FOR UPDATE nowait</h2>
<p>Gives you an error immedieatly if resource is busy.</p>
<h2>Current of (VERY IMPORTANT)</h2>
<p>Imagine a case where you have a table EMP that has 2 duplicate employees with same name and same salary
when you write a sql cursor loop</p>
<pre class="hljs"><code><span class="hljs-keyword">DECLARE</span>
<span class="hljs-keyword">cursor</span> c_emp <span class="hljs-keyword">is</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> EMP <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>;
<span class="hljs-keyword">BEGIN</span>
<span class="hljs-keyword">FOR</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> c_emp 
LOOP
<span class="hljs-keyword">update</span> EMP <span class="hljs-keyword">set</span> salary <span class="hljs-operator">=</span> salary <span class="hljs-operator">+</span> <span class="hljs-number">1000</span>
    <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> row.name;
<span class="hljs-keyword">END</span> LOOP;
<span class="hljs-keyword">END</span>

</code></pre>
<p>This code will give you a problem because it loops and uses update statments which loops again to find a row that matches the name from your cursor, making it n^2 complexity in addition to it will increase the salary twice for duplicate names to fix this we use where current</p>
<pre class="hljs"><code>CURSOR c_emp IS
  SELECT * FROM emp FOR UPDATE;

FOR row IN c_emp LOOP
  UPDATE emp
  SET salary = salary + 1000
  WHERE CURRENT OF c_emp;
END LOOP;
END
</code></pre>

            </div>

            <footer class="article-footer">
                <a href="/posts.html"><i class="fas fa-arrow-left"></i> All Posts</a>
                <a href="/">Home</a>
            </footer>
        </article>
    </div>

    <script>
    // Theme
    const toggleBtn = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    function setTheme(m) {
        document.body.classList.toggle('dark-mode', m === 'dark');
        themeIcon.className = m === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        localStorage.setItem('theme', m);
    }
    toggleBtn.addEventListener('click', () => setTheme(document.body.classList.contains('dark-mode') ? 'light' : 'dark'));
    if (localStorage.getItem('theme') === 'dark') setTheme('dark');

    document.getElementById('nav-hamburger').addEventListener('click', () => {
        document.getElementById('nav-links').classList.toggle('open');
    });

    // Copy buttons for code blocks
    document.querySelectorAll('pre.hljs').forEach(pre => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-wrapper';
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.textContent = 'Copy';
        wrapper.appendChild(btn);

        btn.addEventListener('click', () => {
            const code = pre.querySelector('code');
            navigator.clipboard.writeText(code ? code.textContent : pre.textContent);
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 1500);
        });
    });
    </script>
    
</body>
</html>
