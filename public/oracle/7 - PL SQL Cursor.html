<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 - PL SQL Cursor - Albasel</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/github-dark.css">
    <link rel="stylesheet" href="../css/highlight.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .series-info {
            background: #333;
            color: white;
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: var(--shadow-md);
        }
        .series-info a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        .series-info a:hover {
            text-decoration: underline;
        }
        .series-progress {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .series-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid rgba(0, 0, 0, 0.1);
            gap: 1rem;
        }
        .nav-link {
            display: flex;
            flex-direction: column;
            padding: 1.25rem;
            background: rgba(126, 179, 214, 0.1);
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.2s;
            max-width: 45%;
            border: 2px solid transparent;
        }
        .nav-link:hover {
            background: rgba(126, 179, 214, 0.2);
            transform: translateY(-2px);
            border-color: var(--accent-blue);
        }
        .nav-link-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        .nav-link-title {
            font-weight: bold;
            line-height: 1.3;
            color: var(--text-dark);
        }
        .nav-placeholder {
            width: 45%;
        }
        body.dark-mode .series-navigation {
            border-top: 2px solid #444;
        }
        body.dark-mode .nav-link {
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
        }
        body.dark-mode .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-blue);
        }
        body.dark-mode .nav-link-label {
            color: #aaa;
        }
        body.dark-mode .nav-link-title {
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <aside class="sidebar">
    <div class="sidebar-profile">
        <img src="/images/avatar.jpeg" alt="Albasel" class="sidebar-avatar">
        <div class="sidebar-name">Albasel</div>
        <div class="sidebar-bio">Iam a Computer Science student. I do computer graphics, AI and random programming stuff.</div>
    </div>
    
    <nav class="sidebar-nav">
        <ul>
            <li>
                <a href="/">
                    <i class="fa-solid fa-home"></i>
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="/posts.html">
                    <i class="fa-solid fa-newspaper"></i>
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="/categories.html">
                    <i class="fa-solid fa-tags"></i>
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="/aboutme.html">
                    <i class="fa-solid fa-user"></i>
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
    
    <div class="theme-toggle-sidebar">
        <button class="theme-toggle-btn" id="theme-toggle" aria-label="Toggle dark mode">
            <i class="fa-solid fa-moon" id="theme-icon"></i>
            <span>Dark Mode</span>
        </button>
    </div>
</aside>

    <main class="main-content">
        <div class="container">
            
            <div class="series-info">
                <div>
                    <i class="fas fa-book"></i>
                    <strong>Part 7 of 7</strong> in
                    <a href="/oracle/">oracle-pl-sql</a>
                </div>
                <div class="series-progress">
                    7/7
                </div>
            </div>
            

            <article class="post">
                <header class="post-header">
                    <h1>7 - PL SQL Cursor</h1>
                    <div class="post-meta">
                        <time>2025-09-02</time>
                        
                        <span class="series-tag"><i class="fas fa-book"></i> Series</span>
                    </div>
                    
                </header>
                
                <div class="post-content">
                    <h1>7   Cursor</h1>
<p>A cursor in PL/SQL is a pointer (or handle) to the result set of a SQL query.</p>
<ul>
<li>It allows PL/SQL to access rows returned by SQL one by one.</li>
<li>Without cursors, PL/SQL wouldn’t know how to deal with multi-row results.</li>
</ul>
<h2>Implicit Cursors:</h2>
<p>Created automatically by Oracle when you run a SQL statement.
Used for:</p>
<ul>
<li>INSERT, UPDATE, DELETE, MERGE</li>
<li>SELECT … INTO … (must return exactly one row).</li>
</ul>
<p>Attributes you can check:</p>
<ul>
<li><strong>SQL%ROWCOUNT</strong> → number of rows affected.</li>
<li><strong>SQL%FOUND</strong> → TRUE if rows were affected.</li>
<li><strong>SQL%NOTFOUND</strong> → TRUE if no rows were affected.</li>
<li><strong>SQL%ISOPEN</strong> → always&gt;</li>
</ul>
<h2>Explicit Cursor</h2>
<ul>
<li>Declare</li>
<li>Open</li>
<li>Fetch</li>
<li>Close</li>
</ul>
<h3>Explicit Cursor Attributes</h3>
<ul>
<li><strong>%ISOPEN</strong>
<ul>
<li>Checks if the cursor is read</li>
</ul>
</li>
<li><strong>%FOUND</strong>
<ul>
<li>Checks if data is found</li>
</ul>
</li>
<li><strong>%NOTFOUND</strong>
<ul>
<li>Checks if data is not f</li>
</ul>
</li>
<li><strong>%ROWCOUNT</strong>
<ul>
<li>returns number of data returned</li>
</ul>
</li>
</ul>
<h2>FOR UPDATE</h2>
<p>This keyword locks the records a cursor is selecting until you finish working on the query.</p>
<pre class="hljs"><code>DECLARE 
cursor c_emp is
       SELECT * FROM Employee WHERE Department_id = 30 FOR UPDATE
BEGIN
     for v_emp in c_emp
     LOOP
     dbms_output.putline(...)
     END LOOP
END                       
</code></pre>
<p>Now if someone is trying to update this row the cursor is pointing at he can’t as its locked for waiting until you rollback or you can define it so it gives him an error or wait for some time.</p>
<h2>FOR UPDATE nowait</h2>
<p>Gives you an error immedieatly if resource is busy.</p>
<h2>Current of (VERY IMPORTANT)</h2>
<p>Imagine a case where you have a table EMP that has 2 duplicate employees with same name and same salary
when you write a sql cursor loop</p>
<pre class="hljs"><code><span class="hljs-keyword">DECLARE</span>
<span class="hljs-keyword">cursor</span> c_emp <span class="hljs-keyword">is</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> EMP <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>;
<span class="hljs-keyword">BEGIN</span>
<span class="hljs-keyword">FOR</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> c_emp 
LOOP
<span class="hljs-keyword">update</span> EMP <span class="hljs-keyword">set</span> salary <span class="hljs-operator">=</span> salary <span class="hljs-operator">+</span> <span class="hljs-number">1000</span>
    <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> row.name;
<span class="hljs-keyword">END</span> LOOP;
<span class="hljs-keyword">END</span>

</code></pre>
<p>This code will give you a problem because it loops and uses update statments which loops again to find a row that matches the name from your cursor, making it n^2 complexity in addition to it will increase the salary twice for duplicate names to fix this we use where current</p>
<pre class="hljs"><code>CURSOR c_emp IS
  SELECT * FROM emp FOR UPDATE;

FOR row IN c_emp LOOP
  UPDATE emp
  SET salary = salary + 1000
  WHERE CURRENT OF c_emp;
END LOOP;
END
</code></pre>

                </div>
                
                
                <nav class="series-navigation">
                    
                        <a href="/oracle/6 - PL SQL Collections.html" class="nav-link">
                            <span class="nav-link-label"><i class="fas fa-arrow-left"></i> Previous</span>
                            <span class="nav-link-title">6   PL SQL Collections</span>
                        </a>
                    
                    
                    
                        <div class="nav-placeholder"></div>
                    
                </nav>
                
                
                <footer class="post-footer">
                    
                        <a href="/oracle/" class="back-link"><i class="fas fa-book"></i> Back to oracle-pl-sql</a>
                    
                    <a href="/" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
                </footer>
            </article>
        </div>
    </main>
    
    <script>
    const toggleBtn = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.querySelector('.theme-toggle-btn span');
    
    function setTheme(mode) {
        document.body.classList.toggle('dark-mode', mode === 'dark');
        if (mode === 'dark') {
            themeIcon.className = 'fa-solid fa-sun';
            if (themeText) themeText.textContent = 'Light Mode';
        } else {
            themeIcon.className = 'fa-solid fa-moon';
            if (themeText) themeText.textContent = 'Dark Mode';
        }
        localStorage.setItem('theme', mode);
    }
    
    toggleBtn.addEventListener('click', () => {
        const isDark = !document.body.classList.contains('dark-mode');
        setTheme(isDark ? 'dark' : 'light');
    });
    
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') setTheme('dark');
    </script>
</body>
</html>